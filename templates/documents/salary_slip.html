<!-- Action Bar (hidden in PDF) -->
<div class="action-bar">
    <div class="action-bar-container">
        <!-- Download Button (local only) -->
        <form action="{{ url_for('generate') }}" method="POST" class="action-form">
            <input type="hidden" name="upload_to_drive" value="false">
            <button type="submit" class="btn btn-primary">
                <span class="btn-icon">üì•</span>
                <span class="btn-text">Download</span>
            </button>
        </form>

        <!-- Download & Save to Drive -->
        <form action="{{ url_for('generate') }}" method="POST" class="action-form">
            <input type="hidden" name="upload_to_drive" value="true">
            <button type="submit" class="btn btn-success">
                <span class="btn-icon">‚òÅÔ∏è</span>
                <span class="btn-text">Download & Save to Drive</span>
            </button>
        </form>

        <!-- Print Button -->
        <button type="button" class="btn btn-secondary" onclick="window.print()">
            <span class="btn-icon">üñ®Ô∏è</span>
            <span class="btn-text">Print</span>
        </button>

        <!-- Cancel Button -->
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-danger">
            <span class="btn-icon">‚úï</span>
            <span class="btn-text">Cancel</span>
        </a>
    </div>
</div>

<style>
    /* Action bar styling ‚Äì same as before, hidden in print */
    .action-bar {
        background: white;
        border-bottom: 1px solid #e9ecef;
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .action-bar-container {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        align-items: center;
        padding: 0 20px;
    }
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .btn-primary { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
    .btn-success { background: linear-gradient(135deg, #1e7e34 0%, #28a745 100%); color: white; }
    .btn-secondary { background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%); color: white; }
    .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%); color: white; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
    .btn-icon { font-size: 18px; }
    @media print { .action-bar { display: none !important; } }
    @page {
        size: A4;
        margin: 2cm;          /* Adjust as needed: top, bottom, left, right */
    }


    /* PDF-friendly styles */
    .offer-letter {
        font-family: 'Arial', sans-serif;
        max-width: 800px;
        margin: 0 auto;
        border: 1px solid #e0e0e0;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
        padding: 30px;
        position: relative;
        page-break-after: avoid;
        page-break-inside: avoid;
        background-color: white;
    }
    .letter-header {
        border-bottom: 2px solid #0d6efd;
        padding-bottom: 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 3rem;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 12px;
    }
    th {
        background-color: #0d6efd;
        color: white;
        padding: 10px;
        text-align: left;
        border-bottom: 2px solid #0a58ca;
    }
    td {
        padding: 8px;
        border-bottom: 1px solid #dee2e6;
    }
    .total-row {
        background-color: #e9ecef;
        font-weight: bold;
    }
    @media print {
        body { margin: 0; padding: 0; }
        .offer-letter {
            border: none !important;
            box-shadow: none !important;
            padding: 15mm !important;
        }
    }
    @page {
        size: A4 portrait;
        margin-top: 15mm;
        margin-bottom: 15mm;
        margin-left: 15mm;
        margin-right: 15mm;
    }
</style>

<!-- Watermark placed OUTSIDE the main container ‚Äì appears on every page in PDF -->
{% include '_watermark.html' %}

<!-- Loop over each month -->
{% for month in months %}
<div class="offer-letter">
    <!-- Letterhead -->
    <div class="letter-header">
        <div style="flex: 0 0 auto;">
            <img src="{{ request.url_root }}static/images/{{ company.logo }}"
                 alt="{{ company.name }} Logo"
                 style="height: 90px; max-width: 450px; object-fit: contain;">
        </div>
        <div style="flex: 1; text-align: left;">
            <p style="color: #555; font-size: 12px; margin: 5px 0; line-height: 1.4;">
                <strong>Office:</strong> {{ company.address }}<br>
                <strong>Phone:</strong> {{ company.phone }}<br>
                <strong>Email:</strong> {{ company.email }}<br>
                <strong>Website:</strong> {{ company.website }}
            </p>
        </div>
    </div>

    <!-- Employee Details -->
    <div style="margin-bottom: 20px; background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #e0e0e0;">
        <div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 250px;">
                <p style="margin: 5px 0;"><strong>Employee Name:</strong> {{ data.full_name | default('', true) }}</p>
                <p style="margin: 5px 0;"><strong>Designation:</strong> {{ data.designation | default('', true) }}</p>
                <p style="margin: 5px 0;"><strong>Bank Name:</strong> {{ data.bank_details.bank_name | default('', true) }}</p>
                <p style="margin: 5px 0;"><strong>Account No.:</strong> {{ data.bank_details.account_number | default('', true) }}</p>
            </div>
            <div style="flex: 1; min-width: 250px;">
                <p style="margin: 5px 0;"><strong>Month:</strong> {{ month }} </p>
                <p style="margin: 5px 0;"><strong>Employee ID:</strong> {{ data.employee_id }} </p>
                <p style="margin: 5px 0;"><strong>CTC (Annual):</strong> ‚Çπ{{ "{:,.2f}".format(data.ctc|float) }}</p>
            </div>
        </div>
    </div>

    <!-- Salary calculations -->
    {% set basic = ((data.ctc|float) * 0.5 / 12) | round(0) %}
    {% set hra = (basic * 0.5) | round(0) %}
    {% set conveyance = (data.ctc|float * 0.05 / 12) | round(0) %}
    {% set medical = (data.ctc|float * 0.014 / 12) | round(0) %}
    {% set telephone = (data.ctc|float * 0.02 / 12) | round(0) %}
    {% set special_allowance = ((data.ctc|float /12) - (basic + hra + conveyance + medical + telephone)) | round(0) %}
    {% set professional_tax = 200 %}
    {% set gross_salary = basic + hra + conveyance + medical + telephone + special_allowance %}
    {% set total_deductions = professional_tax %}
    {% set net_salary = (gross_salary - total_deductions) | round(0) %}

    <!-- Salary table -->
    <table>
        <thead>
            <tr style="background-color: #0d6efd; color: white;">
                <th>HEAD</th>
                <th style="text-align: right;">EARNINGS (‚Çπ)</th>
                <th style="text-align: right;">DEDUCTIONS (‚Çπ)</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>1. MONTHLY COMPONENTS</strong></td><td></td><td></td></tr>
            <tr><td>Basic Salary</td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(basic) }}</td><td style="text-align: right;">-</td></tr>
            <tr><td>House Rent Allowance (HRA)</td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(hra) }}</td><td style="text-align: right;">-</td></tr>
            <tr><td><strong>2. REIMBURSEMENTS</strong></td><td></td><td></td></tr>
            <tr><td>Conveyance Allowance</td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(conveyance) }}</td><td style="text-align: right;">-</td></tr>
            <tr><td>Medical Allowance</td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(medical) }}</td><td style="text-align: right;">-</td></tr>
            <tr><td>Telephone/Mobile</td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(telephone) }}</td><td style="text-align: right;">-</td></tr>
            <tr><td><strong>3. SPECIAL ALLOWANCE</strong></td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(special_allowance) }}</td><td style="text-align: right;">-</td></tr>
            <tr><td><strong>4. DEDUCTIONS</strong></td><td></td><td></td></tr>
            <tr><td>Professional Tax</td><td style="text-align: right;">-</td><td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(professional_tax) }}</td></tr>
            <tr style="background-color: #e9ecef; font-weight: bold;">
                <td>TOTAL</td>
                <td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(gross_salary) }}</td>
                <td style="text-align: right;">‚Çπ{{ "{:,.2f}".format(total_deductions) }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Net Salary -->
    <div style="text-align: center; margin-top: 20px;">
        <div style="display: inline-block; background-color: #f8f9fa; padding: 15px 30px; border-radius: 5px; border: 1px solid #e0e0e0;">
            <h3 style="color: #0d6efd; margin-bottom: 5px; font-size: 16px; text-transform: uppercase;">
                Net Salary Payable per Month: ‚Çπ{{ "{:,.0f}".format(net_salary) }}
            </h3>
            <p style="font-style: italic; font-size: 13px; margin: 0; color: #555;">
                (‚Çπ{{ "{:,}".format(net_salary|int) }})
            </p>
        </div>
    </div>
</div>

<!-- Page break between salary slips -->
{% if not loop.last %}
<hr style="margin:40px 0; page-break-after: always; visibility: hidden;">
{% endif %}
{% endfor %}