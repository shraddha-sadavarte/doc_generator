<!-- templates/documents/salary_slip.html -->
<!-- Action Bar (hidden in PDF) -->
<div class="action-bar">
    <div class="action-bar-container">
        <!-- Download Button (local only) -->
        <form action="{{ url_for('generate') }}" method="POST" class="action-form">
            <input type="hidden" name="upload_to_drive" value="false">
            <button type="submit" class="btn btn-primary">
                <span class="btn-icon">üì•</span>
                <span class="btn-text">Download</span>
            </button>
        </form>

        <!-- Download & Save to Drive -->
        <form action="{{ url_for('generate') }}" method="POST" class="action-form">
            <input type="hidden" name="upload_to_drive" value="true">
            <button type="submit" class="btn btn-success">
                <span class="btn-icon">‚òÅÔ∏è</span>
                <span class="btn-text">Download & Save to Drive</span>
            </button>
        </form>

        <!-- Print Button -->
        <button type="button" class="btn btn-secondary" onclick="window.print()">
            <span class="btn-icon">üñ®Ô∏è</span>
            <span class="btn-text">Print</span>
        </button>

        <!-- Cancel Button -->
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-danger">
            <span class="btn-icon">‚úï</span>
            <span class="btn-text">Cancel</span>
        </a>
    </div>
</div>

<style>
    /* Action bar styling ‚Äì same as before, hidden in print */
    .action-bar {
        background: white;
        border-bottom: 1px solid #e9ecef;
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .action-bar-container {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        align-items: center;
        padding: 0 20px;
    }
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .btn-primary { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
    .btn-success { background: linear-gradient(135deg, #1e7e34 0%, #28a745 100%); color: white; }
    .btn-secondary { background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%); color: white; }
    .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%); color: white; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
    .btn-icon { font-size: 18px; }
    @media print { .action-bar { display: none !important; } }

    /* PDF page settings */
    @page {
        size: A4;
        margin: 2cm;
    }

    /* Salary slip styles */
    .salary-slip {
        font-family: 'Arial', sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 30px;
        background: white;
        position: relative;
    }
    .header {
        margin-bottom: 20px;
    }
    .header-row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }
    .header-item {
        font-size: 13px;
    }
    .header-item strong {
        display: inline-block;
        width: 100px;
    }
    .employee-details {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
    }
    .employee-details table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }
    .employee-details td {
        padding: 5px;
    }
    .salary-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 13px;
    }
    .salary-table th {
        background: #0d6efd;
        color: white;
        padding: 8px;
        text-align: left;
    }
    .salary-table td {
        padding: 8px;
        border-bottom: 1px solid #dee2e6;
    }
    .salary-table .amount {
        text-align: right;
    }
    .total-row {
        font-weight: bold;
        background-color: #e9ecef;
    }
    .totals {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
    }
    .totals-box {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid #e0e0e0;
        width: 45%;
    }
    .totals-box .label {
        font-size: 14px;
        color: #555;
    }
    .totals-box .value {
        font-size: 20px;
        font-weight: bold;
        color: #0d6efd;
    }
    .additional-details {
        margin-top: 20px;
        font-size: 12px;
        color: #555;
    }
    .additional-details table {
        width: 100%;
        border-collapse: collapse;
    }
    .additional-details td {
        padding: 5px;
    }
    .words {
        margin-top: 20px;
        font-size: 14px;
        font-style: italic;
        text-align: center;
    }
    @media print {
        .salary-slip { padding: 0; }
    }
</style>

<!-- Watermark placed OUTSIDE the main container -->
{% include '_watermark.html' %}

<!-- Loop over each month -->
{% for month in months %}
<div class="salary-slip">
    <!-- Letterhead (optional, you can include company logo if desired) -->
    <div style="margin-bottom: 20px; border-bottom: 2px solid #0d6efd; padding-bottom: 10px;">
        <img src="{{ request.url_root }}static/images/{{ company.logo }}"
             alt="{{ company.name }} Logo"
             style="height: 80px; max-width: 300px; object-fit: contain;">
    </div>

    <!-- Month title -->
    <h3 style="text-align: center; color: #0d6efd; margin-bottom: 20px;">Salary Slip ‚Äì {{ month }} {{ session.get('selected_year', now.year) }}</h3>

    <!-- Employee Information -->
    <div class="employee-details">
        <table>
            <tr>
                <td><strong>Emp. Code:</strong> {{ data.employee_id }}</td>
                <td><strong>Name:</strong> {{ data.full_name }}</td>
                <td><strong>Designation:</strong> {{ data.designation }}</td>
            </tr>
            <tr>
                <td><strong>Date of Joining:</strong> {{ data.joining_date.strftime('%d/%m/%Y') if data.joining_date else '' }}</td>
                <td><strong>Gender:</strong> {{ data.gender or 'Male' }}</td>
                <td><strong>Department:</strong> {{ data.department or 'Information Technology (IT) Department' }}</td>
            </tr>
            <tr>
                <td><strong>PAN Card:</strong> {{ data.pan_no or 'N/A' }}</td>
                <td><strong>Worked Days:</strong> {{ data.worked_days or 30 }}</td>
                <td><strong>LOP:</strong> {{ data.lop or 0 }}</td>
            </tr>
            <tr>
                <td><strong>Paid Days:</strong> {{ data.paid_days or 30 }}</td>
                <td colspan="2"></td>
            </tr>
        </table>
    </div>

    <!-- Earnings & Deductions Table -->
    <table class="salary-table">
        <thead>
            <tr>
                <th>Earnings</th>
                <th class="amount">Current Month</th>
                <th>Deductions</th>
                <th class="amount">Current Month</th>
            </tr>
        </thead>
        <tbody>
            <!-- Row 1: Basic vs Professional Tax -->
            <tr>
                <td>Basic</td>
                <td class="amount">{{ "{:,.0f}".format(data.basic|default(0)) }}</td>
                <td>Professional Tax</td>
                <td class="amount">{{ "{:,.0f}".format(data.professional_tax|default(200)) }}</td>
            </tr>
            <!-- Row 2: HRA vs Income Tax -->
            <tr>
                <td>HRA</td>
                <td class="amount">{{ "{:,.0f}".format(data.hra|default(0)) }}</td>
                <td>Income Tax</td>
                <td class="amount">{{ "{:,.0f}".format(data.income_tax|default(0)) }}</td>
            </tr>
            <!-- Row 3: Medical vs Other -->
            <tr>
                <td>Medical</td>
                <td class="amount">{{ "{:,.0f}".format(data.medical|default(0)) }}</td>
                <td>Other</td>
                <td class="amount">{{ "{:,.0f}".format(data.other_deductions|default(0)) }}</td>
            </tr>
            <!-- Row 4: Internet/Mobile vs Provident Fund -->
            <tr>
                <td>Internet/Mobile</td>
                <td class="amount">{{ "{:,.0f}".format(data.internet|default(0)) }}</td>
                <td>Provident Fund</td>
                <td class="amount">{{ "{:,.0f}".format(data.provident_fund|default(0)) }}</td>
            </tr>
            <!-- Row 5: Other Allowances vs Paid Leave -->
            <tr>
                <td>Other Allowances</td>
                <td class="amount">{{ "{:,.0f}".format(data.other_allowances|default(0)) }}</td>
                <td>Paid Leave</td>
                <td class="amount">{{ "{:,.0f}".format(data.paid_leave|default(0)) }}</td>
            </tr>
            <!-- Total row -->
            <tr class="total-row">
                <td>GROSS EARNINGS</td>
                <td class="amount">{{ "{:,.2f}".format(data.gross_earnings|default(0)) }}</td>
                <td>GROSS DEDUCTIONS</td>
                <td class="amount">{{ "{:,.2f}".format(data.gross_deductions|default(0)) }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Net Salary and Words -->
    <div style="text-align: right; margin-top: 10px;">
        <strong>NET Salary:</strong> Rs. {{ "{:,.0f}".format(data.net_salary|default(0)) }}/-
    </div>

    <!-- Amount in Words -->
    <div class="words">
        <strong>Net Payable in Words:</strong> {{ data.words or 'Twenty Three Thousands Nine Hundred And Sixty Eight Rupees' }}
    </div>
</div>

<!-- Page break between salary slips -->
{% if not loop.last %}
<hr style="margin:40px 0; page-break-after: always; visibility: hidden;">
{% endif %}
{% endfor %}