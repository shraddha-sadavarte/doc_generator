<!-- Action Bar -->
<div class="action-bar">
    <div class="action-bar-container">
        <!-- Download Button -->
        <form action="{{ url_for('generate') }}" method="POST" class="action-form">
            <button type="submit" class="btn btn-primary">
                <span class="btn-icon">üì•</span>
                <span class="btn-text">Download</span>
            </button>
        </form>

        <!-- NEW: Download & Upload to Drive Button -->
        <form action="{{ url_for('generate') }}" method="POST" class="action-form">
            <input type="hidden" name="upload_to_drive" value="true">
            <button type="submit" class="btn btn-success">
                <span class="btn-icon">‚òÅÔ∏è</span>
                <span class="btn-text">Download & Save to Drive</span>
            </button>
        </form>

        <!-- Print Button -->
        <button type="button" class="btn btn-secondary" onclick="window.print()">
            <span class="btn-icon">üñ®Ô∏è</span>
            <span class="btn-text">Print</span>
        </button>

        <!-- Cancel Button -->
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-danger">
            <span class="btn-icon">‚úï</span>
            <span class="btn-text">Cancel</span>
        </a>
    </div>
</div>

<style>
    /* Action Bar Container */
    .action-bar {
        background: white;
        border-bottom: 1px solid #e9ecef;
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .action-bar-container {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        align-items: center;
        padding: 0 20px;
    }

    /* Base Button Styles */
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        letter-spacing: 0.3px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .btn:before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .btn:hover:before {
        width: 300px;
        height: 300px;
    }

    .btn-icon {
        font-size: 18px;
        position: relative;
        z-index: 1;
    }

    .btn-text {
        position: relative;
        z-index: 1;
    }

    /* Primary Button - Green */
    .btn-primary {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        background: linear-gradient(135deg, #218838 0%, #1ba87e 100%);
    }

    .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
    }

    .btn-success {
        background: linear-gradient(135deg, #1e7e34 0%, #28a745 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        background: linear-gradient(135deg, #1e7e34 0%, #218838 100%);
    }

    .btn-success:active {
        transform: translateY(0);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
    }

    /* Secondary Button - Blue */
    .btn-secondary {
        background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.2);
    }

    .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(13, 110, 253, 0.3);
        background: linear-gradient(135deg, #0b5ed7 0%, #0bb5d9 100%);
    }

    .btn-secondary:active {
        transform: translateY(0);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.2);
    }

    /* Danger Button - Red */
    .btn-danger {
        background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        background: linear-gradient(135deg, #c82333 0%, #d62c1a 100%);
    }

    .btn-danger:active {
        transform: translateY(0);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
    }

    /* Hide buttons in print mode */
    @media print {
        .action-bar {
            display: none !important;
        }
    }

    @page {
        size: A4;
        margin: 2cm;          /* Adjust as needed: top, bottom, left, right */
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .action-bar-container {
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .btn {
            padding: 10px 16px;
            font-size: 14px;
        }

        .btn-text {
            display: inline-block;
        }
    }

    @media (max-width: 480px) {
        .btn {
            padding: 8px 12px;
        }
        
        .btn-text {
            display: none;
        }
        
        .btn-icon {
            font-size: 20px;
            margin: 0;
        }
    }

    /* Salary Breakdown Styles */
    .salary-breakdown {
        margin: 30px 0;
        padding: 20px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        border-left: 6px solid #28a745;
    }

    .salary-breakdown h4 {
        color: #28a745;
        margin-bottom: 20px;
        font-size: 18px;
        font-weight: 600;
    }

    .salary-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .salary-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .salary-label {
        color: #6c757d;
        font-weight: 500;
    }

    .salary-value {
        font-weight: 600;
        color: #28a745;
    }

    .total-ctc {
        margin-top: 20px;
        padding: 15px;
        background: white;
        border-radius: 8px;
        text-align: center;
        border: 2px dashed #28a745;
    }

    .total-ctc .label {
        color: #6c757d;
        font-size: 14px;
    }

    .total-ctc .value {
        font-size: 24px;
        font-weight: 700;
        color: #28a745;
    }
</style>

<!-- Watermark placed OUTSIDE the main container ‚Äì appears on every page in PDF -->
{% include '_watermark.html' %}

<div class="increment-letter" style="font-family: 'Arial', sans-serif; max-width: 800px; margin: 0 auto; padding: 30px; position: relative; background-color: white;">
    <!-- Letterhead with decorative border -->
    <div class="letter-header mb-4" style="border-bottom: 2px solid #0d6efd; padding-bottom: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; gap: 3rem;">
        <!-- Logo on the left -->
        <div style="flex: 0 0 auto;">
            <img src="{{ request.url_root }}static/images/{{ company.logo }}" 
                 alt="{{ company.name }} Logo" 
                 style="height: 150px; max-width: 400px; object-fit: contain;">
        </div>
        
        <!-- Company info on the right -->
        <div style="flex: 1; text-align: left;">
            <div style="display: flex; justify-content: space-between;">
                <p style="color: #555; font-size: 14px;">
                    <strong>Office:</strong> {{ company.address }}<br>
                    <strong>Phone:</strong> {{ company.phone }}<br>
                    <strong>Email:</strong> {{ company.email }}<br>
                    <strong>Website:</strong> {{ company.website }}<br>
                </p>
            </div>
        </div>
    </div>

    <!-- Letter Title -->
    <h2 class="text-center" style="color: #0d6efd; text-align: center; margin-bottom: 30px;">
        Increment Letter
    </h2>

    <!-- Employee Details -->
    <div style="margin-bottom: 20px;">
        <p style="font-weight: bold; margin-bottom: 5px;">{{ data.full_name|title }}</p>
        <p style="margin-top: 0;">EMP ID - {{ data.employee_id or 'Not Specified' }}</p>
    </div>

    <!-- Date -->
    <div style="text-align: right; margin-bottom: 20px;">
        <strong>Date:</strong> {{ now.strftime('%d %B %Y') }}
    </div>

    <!-- Salutation -->
    <p style="margin-bottom: 20px;">
        Dear {{data.full_name.split(' ')[0]|capitalize if data.full_name else 'Employee' }},
    </p>

    <!-- Letter Content -->
    <div style="text-align: justify; line-height: 1.6; margin-bottom: 30px;">
        <p>
            You are aware of the recent salary appraisal/changes in the levels being planned. New levels and
            corresponding titles are being introduced and you, along with all other employees, will be placed in the
            new set.
        </p>

        <p>
            We are pleased to inform you that your salary has been increased by <strong>Rs. {{ "{:,.0f}".format(data.salary_breakdown['increment_per_month']|float) }} per month</strong>, 
            positioned at <strong>{{ data.designation|title }}</strong>. Your employment records are being updated to reflect the
            same. Kindly note that salary appraisal/fitment is a function of a direct one-on-one change for all
            employees. This is based on an individual evaluation, which was done in the appraisal process.
        </p>

        <p>
            <strong>Your revised Cost to Company (CTC) will be Rs. {{ "{:,.0f}".format(data.ctc|float + (data.salary_breakdown['increment_per_month']|float * 12)) }} per annum.</strong>
        </p>

        <p>
            This increment will be effective from 
            <strong>
                {% set effective_date = now + timedelta(days=30) %}
                {{ effective_date.strftime('%d %B %Y') }}
            </strong>, i.e., starting from next month.
        </p>

        <p>
            There is no change in your employment status and the terms and condition of your employment and
            policies of the company governing it. Changes to the policies, if any, will be published in the respective
            manuals that are available to all employees, on the intranet. We appreciate your commitment to the
            organization and look forward to many more years of association. We wish you success in all future
            endeavours.
        </p>
    </div>

    <!-- Salary Breakdown Section (NEW) -->
    {% if data.salary_breakdown %}
    <div class="salary-breakdown">
        <h4>üìä Revised Salary Breakdown</h4>
        <div class="salary-grid">
            <div class="salary-item">
                <span class="salary-label">Basic Salary (50%):</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.basic|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">HRA (50% of Basic):</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.hra|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">Conveyance:</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.conveyance|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">Medical:</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.medical|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">Telephone:</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.telephone|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">Special Allowance:</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.special_allowance|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">Professional Tax:</span>
                <span class="salary-value">-‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.professional_tax|float) }}</span>
            </div>
            <div class="salary-item">
                <span class="salary-label">Gross Salary:</span>
                <span class="salary-value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.gross_salary|float) }}</span>
            </div>
        </div>
        
        <div class="total-ctc">
            <div class="label">New Monthly Net Salary</div>
            <div class="value">‚Çπ{{ "{:,.0f}".format(data.salary_breakdown.net_salary|float) }}</div>
        </div>
    </div>
    {% endif %}

        <!-- Closing -->
    <div class="row mt-5" style="margin-top: 50px;">
        <div class="col-md-6">
            <div style="height: 80px; margin-bottom: 10px;">
                {% if company.signature %}
                    <img src="{{ request.url_root }}static/images/signatures/{{ company.signature }}" 
                         alt="Authorized Signature" 
                         style="height: 100px; max-width: 200px; object-fit: contain;">
                {% endif %}
            </div>
            <p style="margin-bottom: 0;">
                <strong>{{ company.hr_name }}</strong><br>
                {{ company.hr_designation }}<br>
                <span style="font-size: 14px; color: #111111;"><strong>{{ company.name }}</strong></span>
            </p>
        </div>
    </div>

    <!-- Footer -->
    <div style="margin-top: 40px; border-top: 1px solid #e0e0e0; padding-top: 10px; font-size: 12px; color: #777; text-align: center;">
        <p style="margin-bottom: 0;">
            *Company Confidential - This communication is confidential between you and {{ company.name }}
        </p>
    </div> 
</div>